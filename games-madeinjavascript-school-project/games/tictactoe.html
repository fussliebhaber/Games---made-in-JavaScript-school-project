<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Tic Tac Toe vs Smart AI</title>
    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: #121212;
        font-family: sans-serif;
        color: #fff;
      }
      #wrapper {
        display: flex;
        flex-direction: column;
        align-items: center;
        width: 90vmin;
        height: 100vmin;
      }
      #game-container {
        width: 100%;
        flex: 1;
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        grid-template-rows: repeat(3, 1fr);
        gap: 5px;
        background: #1f1f1f;
        border-radius: 10px;
        padding: 5px;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.7);
      }
      .cell {
        background: #2c2c2c;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 8vmin;
        cursor: pointer;
        user-select: none;
        border-radius: 10px;
        transition: background 0.2s;
      }
      .cell:hover {
        background: #3a3a3a;
      }
      #reset {
        width: 100%;
        margin-top: 5px;
        padding: 2vmin;
        font-size: 4vmin;
        cursor: pointer;
        border: none;
        border-radius: 8px;
        background: #444;
        color: #fff;
        transition: background 0.2s;
      }
      #reset:hover {
        background: #666;
      }
    </style>
  </head>
  <body>
    <div id="wrapper">
      <div id="game-container"></div>
      <button id="reset">Reset Game</button>
    </div>

    <script>
      const container = document.getElementById("game-container");
      let board = Array(9).fill("");
      let currentPlayer = "X"; // X = player, O = computer
      let gameOver = false;
      let lastComputerMove = null;

      // Create cells
      for (let i = 0; i < 9; i++) {
        const cell = document.createElement("div");
        cell.classList.add("cell");
        cell.dataset.index = i;
        cell.addEventListener("click", playerMove);
        container.appendChild(cell);
      }

      // Player move
      function playerMove(e) {
        const index = e.target.dataset.index;
        if (board[index] !== "" || gameOver) return;
        board[index] = "X";
        e.target.textContent = "X";

        if (checkWin("X")) {
          setTimeout(() => alert("You win!"), 10);
          gameOver = true;
          return;
        }
        if (board.every((c) => c !== "")) {
          setTimeout(() => alert("Draw!"), 10);
          gameOver = true;
          return;
        }

        setTimeout(computerMove, 200);
      }

      // Computer move with smarter strategy
      function computerMove() {
        if (gameOver) return;

        // 1️⃣ Win if possible
        let move = findWinningMove("O");

        // 2️⃣ Block player if about to win
        if (move === null) {
          move = findWinningMove("X");
        }

        // 3️⃣ First move: pick corner
        if (move === null && lastComputerMove === null) {
          const corners = [0, 2, 6, 8];
          const emptyCorners = corners.filter((i) => board[i] === "");
          move = emptyCorners[Math.floor(Math.random() * emptyCorners.length)];
        }

        // 4️⃣ Otherwise prefer strategic moves: center > corners > edges
        if (move === null) {
          const preferred = [4, 0, 2, 6, 8, 1, 3, 5, 7];
          move = preferred.find((i) => board[i] === "");
        }

        // 5️⃣ Make the move
        board[move] = "O";
        document.querySelector(`.cell[data-index='${move}']`).textContent = "O";
        lastComputerMove = move;

        // 6️⃣ Check for game over
        if (checkWin("O")) {
          setTimeout(() => alert("Computer wins!"), 10);
          gameOver = true;
          return;
        }
        if (board.every((c) => c !== "")) {
          setTimeout(() => alert("Draw!"), 10);
          gameOver = true;
          return;
        }
      }

      // Find winning/blocking move
      function findWinningMove(player) {
        const combos = [
          [0, 1, 2],
          [3, 4, 5],
          [6, 7, 8],
          [0, 3, 6],
          [1, 4, 7],
          [2, 5, 8],
          [0, 4, 8],
          [2, 4, 6],
        ];
        for (let combo of combos) {
          const marks = combo.map((i) => board[i]);
          if (
            marks.filter((v) => v === player).length === 2 &&
            marks.includes("")
          ) {
            return combo[marks.indexOf("")];
          }
        }
        return null;
      }

      // Check for win
      function checkWin(player) {
        const combos = [
          [0, 1, 2],
          [3, 4, 5],
          [6, 7, 8],
          [0, 3, 6],
          [1, 4, 7],
          [2, 5, 8],
          [0, 4, 8],
          [2, 4, 6],
        ];
        return combos.some((c) => c.every((i) => board[i] === player));
      }

      // Reset
      document.getElementById("reset").addEventListener("click", () => {
        board = Array(9).fill("");
        currentPlayer = "X";
        gameOver = false;
        lastComputerMove = null;
        document.querySelectorAll(".cell").forEach((c) => (c.textContent = ""));
      });
    </script>
  </body>
</html>
