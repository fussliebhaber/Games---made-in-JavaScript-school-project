<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vokabeltrainer</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Inter Schriftart (passend zu Tailwind) */
      body {
        font-family: "Inter", sans-serif;
      }

      /* Container für die 3D-Karte */
      .card-container {
        perspective: 1000px; /* Erzeugt die 3D-Tiefe */
      }

      .card-inner {
        position: relative;
        width: 100%;
        height: 100%;
        transition: transform 0.6s;
        transform-style: preserve-3d; /* Wichtig für die 3D-Drehung */
      }

      /* Wenn die Karte umgedreht ist, drehe den inneren Container */
      .card-container.flipped .card-inner {
        transform: rotateY(180deg);
      }

      /* * FIX: Reparierte CSS-Regeln für Vorder- und Rückseite.
         * Das Problem war, dass .card-front fälschlicherweise auch gedreht wurde.
         */

      /* Geteilte Stile für beide Seiten */
      .card-front,
      .card-back {
        position: absolute;
        width: 100%;
        height: 100%;
        -webkit-backface-visibility: hidden; /* Für Safari */
        backface-visibility: hidden; /* Versteckt die Rückseite, wenn sie nicht sichtbar ist */
        display: flex;
        align-items: center;
        justify-content: center;
        flex-direction: column;
        padding: 2rem;
        border-radius: 0.75rem; /* rounded-xl */
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1),
          0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-lg */
      }

      /* Nur Vorderseite */
      .card-front {
        background-color: white;
        color: black;
        /* Kein transform hier, bleibt bei 0deg */
      }

      /* Nur Rückseite */
      .card-back {
        background-color: #374151; /* bg-gray-700 */
        color: white;
        transform: rotateY(180deg); /* Dreht die Rückseite standardmäßig weg */
      }

      /* Stil für die Erklärung */
      .explanation {
        font-size: 0.9rem;
        font-style: italic;
        color: #d1d5db; /* text-gray-300 */
        margin-top: 1rem;
        text-align: center;
      }

      /* Erklärung auf der Vorderseite (heller) */
      .card-front .explanation {
        color: #6b7280; /* text-gray-500 */
      }

      /* Stile für den neuen Quiz-Modus */
      .quiz-option {
        transition: background-color 0.2s;
      }
      .quiz-option.correct {
        background-color: #22c55e !important; /* bg-green-500 */
        color: white;
        border-color: #22c55e !important;
      }
      .quiz-option.incorrect {
        background-color: #ef4444 !important; /* bg-red-500 */
        color: white;
        border-color: #ef4444 !important;
      }

      /* Stile für den Modus-Wechsler */
      .mode-btn {
        transition: all 0.2s;
      }
      .mode-btn.active {
        background-color: #374151; /* bg-gray-700 */
        color: white;
      }

      /* Stile für den "Schreiben"-Modus */
      #write-input {
        border-color: #d1d5db; /* bg-gray-300 */
      }
      #write-input.correct {
        border-color: #22c55e; /* border-green-500 */
        background-color: #f0fdf4; /* bg-green-50 */
        color: #166534; /* text-green-800 */
      }
      #write-input.incorrect {
        border-color: #ef4444; /* border-red-500 */
        background-color: #fef2f2; /* bg-red-50 */
        color: #991b1b; /* text-red-800 */
      }
    </style>
    <!-- Import Inter font -->
    <link
      rel="stylesheet"
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display-swap"
    />
  </head>
  <body class="bg-gray-100 min-h-screen flex items-center justify-center p-4">
    <div class="w-full max-w-md mx-auto">
      <!-- NEU: Modus-Wechsler -->
      <div class="flex justify-center bg-gray-200 rounded-lg p-1 mb-6">
        <button
          id="mode-flashcard"
          class="mode-btn flex-1 py-2 px-4 rounded-lg font-medium text-gray-700"
        >
          Lernkarten
        </button>
        <button
          id="mode-quiz"
          class="mode-btn flex-1 py-2 px-4 rounded-lg font-medium text-gray-700"
        >
          Quiz
        </button>
        <button
          id="mode-write"
          class="mode-btn flex-1 py-2 px-4 rounded-lg font-medium text-gray-700"
        >
          Schreiben
        </button>
      </div>

      <!-- MODUS 1: LERNKARTEN (Flashcards) -->
      <div id="flashcard-view">
        <!-- Fortschrittsanzeige -->
        <div
          id="progress"
          class="text-center text-gray-500 mb-2 font-medium"
        ></div>

        <!-- Karten-Container -->
        <div id="card" class="card-container h-64 w-full cursor-pointer">
          <div class="card-inner">
            <!-- Vorderseite -->
            <div class="card-front">
              <span
                id="card-front-label"
                class="text-xs text-gray-400 uppercase mb-2"
                >Deutsch</span
              >
              <p
                id="card-front-text"
                class="text-2xl font-semibold text-center"
              ></p>
              <p id="card-front-expl" class="explanation"></p>
            </div>
            <!-- Rückseite -->
            <div class="card-back">
              <span
                id="card-back-label"
                class="text-xs text-gray-200 uppercase mb-2"
                >English</span
              >
              <p id="card-back-text-en" class="text-2xl font-semibold"></p>
              <p id="card-back-text-expl" class="explanation"></p>
            </div>
          </div>
        </div>

        <!-- Steuerknöpfe -->
        <div class="flex justify-between mt-6 space-x-2">
          <button
            id="prev-btn"
            class="flex-1 bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-50 transition duration-200"
          >
            Zurück
          </button>
          <button
            id="flip-btn"
            class="flex-1 bg-gray-800 text-white font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-700 transition duration-200"
          >
            Umdrehen
          </button>
          <button
            id="next-btn"
            class="flex-1 bg-white text-gray-700 font-semibold py-2 px-4 rounded-lg shadow-md hover:bg-gray-50 transition duration-200"
          >
            Weiter
          </button>
        </div>

        <!-- Mischen-Knopf & Richtung -->
        <div class="flex justify-between mt-4 space-x-2">
          <button
            id="shuffle-btn"
            class="flex-1 bg-gray-600 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-500 transition duration-200"
          >
            Mischen (S)
          </button>
          <button
            id="toggle-direction-btn"
            class="flex-1 bg-white text-gray-700 font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-50 transition duration-200"
          >
            Richtung (R)
          </button>
        </div>

        <!-- Hilfe-Text -->
        <div class="text-center text-gray-500 text-sm mt-4">
          Steuerung: [←] Zurück | [→] Weiter | [Leertaste] Umdrehen
        </div>
      </div>

      <!-- MODUS 2: QUIZ (Multiple Choice) -->
      <div id="quiz-view" class="hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <div class="flex justify-between items-center mb-4">
            <div id="quiz-progress" class="text-gray-500 font-medium">
              Frage 1 / 38
            </div>
            <div id="quiz-timer" class="text-xl font-bold text-gray-800">
              10
            </div>
          </div>

          <div
            id="quiz-question-wrapper"
            class="text-center mb-6 min-h-[8rem] flex flex-col justify-center"
          >
            <span
              id="quiz-question-label"
              class="text-sm text-gray-400 uppercase mb-1"
              >Was heißt...</span
            >
            <p
              id="quiz-question"
              class="text-3xl font-semibold text-gray-900"
            ></p>
            <p
              id="quiz-explanation"
              class="text-gray-500 text-sm italic mt-1"
            ></p>
          </div>

          <div class="grid grid-cols-2 gap-4">
            <button
              id="quiz-option-0"
              class="quiz-option w-full bg-white text-gray-700 font-semibold py-4 px-4 rounded-lg shadow-md border border-gray-300 hover:bg-gray-50"
            ></button>
            <button
              id="quiz-option-1"
              class="quiz-option w-full bg-white text-gray-700 font-semibold py-4 px-4 rounded-lg shadow-md border border-gray-300 hover:bg-gray-50"
            ></button>
            <button
              id="quiz-option-2"
              class="quiz-option w-full bg-white text-gray-700 font-semibold py-4 px-4 rounded-lg shadow-md border border-gray-300 hover:bg-gray-50"
            ></button>
            <button
              id="quiz-option-3"
              class="quiz-option w-full bg-white text-gray-700 font-semibold py-4 px-4 rounded-lg shadow-md border border-gray-300 hover:bg-gray-50"
            ></button>
          </div>

          <div
            id="quiz-feedback"
            class="text-center font-medium mt-4 h-6"
          ></div>
          <button
            id="quiz-next-btn"
            class="hidden w-full bg-gray-800 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-700 transition duration-200 mt-4"
          >
            Nächste Frage (→)
          </button>
        </div>
      </div>

      <!-- MODUS 3: SCHREIBEN (Eingabe) -->
      <div id="write-view" class="hidden">
        <div class="bg-white p-6 rounded-lg shadow-lg">
          <div id="write-progress" class="text-gray-500 font-medium mb-4">
            Frage 1 / 38
          </div>

          <div
            class="text-center mb-4 min-h-[6rem] flex flex-col justify-center"
          >
            <span
              id="write-question-label"
              class="text-sm text-gray-400 uppercase mb-1"
              >Was heißt...</span
            >
            <p
              id="write-question"
              class="text-3xl font-semibold text-gray-900"
            ></p>
            <p
              id="write-explanation"
              class="text-gray-500 text-sm italic mt-1"
            ></p>
          </div>

          <input
            type="text"
            id="write-input"
            class="w-full text-xl p-4 border-2 rounded-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-gray-800"
            placeholder="Antwort eingeben..."
          />

          <div
            id="write-feedback"
            class="text-center font-medium mt-4 h-12"
          ></div>

          <div class="flex gap-2 mt-2">
            <button
              id="write-check-btn"
              class="flex-1 bg-gray-800 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-700 transition duration-200"
            >
              Prüfen (Enter)
            </button>
            <button
              id="write-show-btn"
              class="flex-1 bg-white text-gray-700 font-semibold py-3 px-4 rounded-lg shadow-md hover:bg-gray-50 transition duration-200"
            >
              Zeigen
            </button>
          </div>
          <button
            id="write-next-btn"
            class="hidden w-full bg-gray-800 text-white font-bold py-3 px-4 rounded-lg shadow-md hover:bg-gray-700 transition duration-200 mt-2"
          >
            Nächste Frage (→)
          </button>
        </div>
      </div>
    </div>

    <script>
      // Vokabeldaten aus dem Bild
      const vocabData = [
        {
          term: "¡Hablamos (español)!",
          translation: "Wir sprechen (Spanisch)!",
        },
        { term: "el español", translation: "Spanisch" },
        { term: "claro", translation: "(na) klar, natürlich" },
        { term: "el padre", translation: "der Vater" },
        { term: "Múnich", translation: "München" },
        { term: "por eso", translation: "deshalb" },
        { term: "en casa", translation: "zu Hause" },
        { term: "la casa", translation: "das Haus" },
        { term: "genial", translation: "genial" },
        { term: "difícil", translation: "schwierig" },
        { term: "quedar", translation: "sich verabreden, sich treffen" },
        { term: "practicar algo", translation: "etw. üben" },
        { term: "vale", translation: "okay, in Ordnung" },
        { term: "la universidad", translation: "die Universität" },
        { term: "la cafetería", translation: "die Cafeteria" },
        { term: "el hotel", translation: "das Hotel" },
        { term: "la empresa", translation: "das Unternehmen, der Betrieb" },
        { term: "el restaurante", translation: "das Restaurant" },
        { term: "el supermercado", translation: "der Supermarkt" },
        { term: "la discoteca", translation: "die Diskothek" },
        { term: "tu, tus", translation: "dein, deine" },
        { term: "el señor, la señora", translation: "der Herr, die Frau" },
        { term: "Marruecos", translation: "Marokko" },
        { term: "el árabe", translation: "Arabisch" },
        { term: "preparar algo", translation: "etw. vorbereiten" },
        {
          term: "el examen, los exámenes",
          translation: "die Prüfung, der Test",
        },
        { term: "significar algo", translation: "etw. bedeuten" },
        { term: "la biblioteca", translation: "die Bibliothek" },
        { term: "la pregunta", translation: "die Frage" },
        { term: "¿cuándo?", translation: "wann?" },
        {
          term: "el examen de Inglés",
          translation: "die Englischklassenarbeit",
        },
        { term: "Inglés", translation: "Englisch (Schulfach)" },
        { term: "mañana", translation: "morgen" },
        { term: "comprender algo", translation: "etw. verstehen" },
        { term: "el texto", translation: "der Text" },
        { term: "leer algo", translation: "etw. lesen" },
        { term: "mucho", translation: "viel, sehr" },
        { term: "así", translation: "so" },
        { term: "¡Buenas tardes!", translation: "Guten Tag!/Guten Abend!" },
        { term: "¡Buenas noches!", translation: "Guten Abend!/Gute Nacht!" },
        {
          term: "más o menos",
          translation: "mehr oder weniger, hier: geht so",
        },
        { term: "mal", translation: "schlecht" },
        { term: "fatal", translation: "mies, furchbar" },
        {
          term: "el compañero, la compañera",
          translation: "der Mitschüler, die Mitschülerin",
        },
        { term: "la clase", translation: "die Klasse, der Unterricht" },
        {
          term: "el compañero de trabajo, la compañera de trabajo",
          translation: "der Arbeitskollege, die Arbeitskollegin",
        },
        { term: "el trabajo", translation: "die Arbeit" },
        {
          term: "estudiar",
          translation: "lernen, hier: zur Schule gehen, studieren",
        },
        { term: "o", translation: "oder" },
        { term: "trabajar", translation: "arbeiten" },
        { term: "charlar", translation: "quatschen, sich unterhalten" },
        { term: "en", translation: "in, an, auf" },
        { term: "la plaza", translation: "der Platz" },
        { term: "no", translation: "nein" },
        { term: "no (vor Verb)", translation: "nicht; kein, keine" },
        { term: "aquí", translation: "hier" },
        { term: "pero", translation: "aber" },
        { term: "ahora", translation: "jetzt" },
        { term: "mi, mis", translation: "mein, meine" },
        { term: "la madre", translation: "die Mutter" },
        { term: "ser", translation: "sein" },
        { term: "¿verdad?", translation: "stimmt’s?, nicht wahr?" },
        { term: "sí", translation: "ja" },
        { term: "el instituto", translation: "die weiterführende Schule" },
        { term: "todavía no", translation: "noch nicht" },
        { term: "todavía", translation: "noch (immer)" },
        { term: "¡Oye!", translation: "Hör mal!, hier: Sag mal!" },
        { term: "hablar", translation: "sprechen" },
        { term: "el gallego", translation: "Galicisch" },
        { term: "el francés", translation: "Französisch" },
        { term: "Lima", translation: "Hauptstadt Perus" },
        { term: "la capital", translation: "die Hauptstadt" },
        { term: "Perú", translation: "Peru" },
        { term: "el quechua", translation: "Quechua" },
        { term: "tú", translation: "du" },
        { term: "¿Cómo te llamas?", translation: "Wie heißt du?" },
        { term: "¿cómo?", translation: "wie?" },
        { term: "¿De dónde eres?", translation: "Woher bist/kommst du?" },
        { term: "¿de dónde?", translation: "woher?" },
        { term: "eres", translation: "du bist" },
        {
          term: "¿Qué lenguas hablas?",
          translation: "Welche Sprachen sprichst du?",
        },
        { term: "¿qué?", translation: "was?; welche?, welcher?, welches?" },
        { term: "la lengua", translation: "die Sprache" },
        { term: "hablas", translation: "du sprichst" },
        { term: "el ejemplo", translation: "das Beispiel" },
        { term: "¡Vamos!", translation: "hier: Los geht’s!" },
        { term: "muy bien", translation: "sehr gut" },
        { term: "muy", translation: "sehr" },
        { term: "bien", translation: "gut" },
        { term: "¿Cómo estás?", translation: "Wie geht’s?" },
        { term: "fenomenal", translation: "großartig" },
        { term: "gracias", translation: "danke" },
        { term: "él/ella", translation: "er/sie" },
        { term: "¿quién?", translation: "wer?" },
        { term: "es", translation: "er/sie ist" },
        { term: "¡Mira!", translation: "Sieh mal!" },
        { term: "un, una", translation: "ein, eine" },
        { term: "el amigo, la amiga", translation: "der Freund, die Freundin" },
        { term: "Alemania", translation: "Deutschland" },
        { term: "encantado, encantada", translation: "angenehm, sehr erfreut" },
        { term: "mucho gusto", translation: "angenehm, sehr erfreut" },
        { term: "¡Venga!", translation: "Los! hier: also" },
        { term: "¡Hasta luego!", translation: "Bis später!, Bis dann!" },
        { term: "¡Adiós!", translation: "Auf Wiedersehen!" },
        { term: "¡Buenos días!", translation: "Guten Tag!" },
        { term: "¡Hola!", translation: "Hallo!" },
        { term: "me llamo", translation: "ich heiße" },
        { term: "soy de", translation: "ich komme aus" },
        { term: "soy", translation: "ich bin" },
        { term: "de", translation: "aus, von" },
        { term: "Madrid", translation: "Hauptstadt Spaniens" },
        { term: "hablo", translation: "ich spreche" },
        { term: "y", translation: "und" },
        { term: "un poco (de)", translation: "ein bisschen" },
        { term: "el inglés", translation: "Englisch" },
        { term: "yo", translation: "ich" },
        { term: "Sevilla", translation: "Stadt in Spanien" },
        { term: "también", translation: "auch" },
        { term: "el alemán", translation: "Deutsch" },
        { term: "¿Qué tal?", translation: "Wie geht’s?" },
        { term: "La Coruña", translation: "Stadt in Spanien" },
        { term: "aprender algo", translation: "etw. lernen" },
        { term: "¿por qué?", translation: "warum?" },
        { term: "juntos, juntas", translation: "zusammen" },
        { term: "recibir algo", translation: "etw. bekommen, erhalten" },
        { term: "el mensaje", translation: "die Nachricht" },
        { term: "¡Buena idea!", translation: "Gute Idee!" },
        { term: "entonces", translation: "dann, also" },
        { term: "escribir algo", translation: "etw. schreiben" },
        { term: "el móvil", translation: "das Handy" },
        { term: "el momento", translation: "der Moment" },
        { term: "solo", translation: "nur" },
        { term: "¡Ya!", translation: "hier: Jetzt hab ich’s!" },
        { term: "vivir (en + sust.)", translation: "(in + S.) leben, wohnen" },
        { term: "cerca", translation: "nah, in der Nähe" },
        { term: "primero", translation: "zuerst" },
        { term: "después", translation: "danach, später" },
        { term: "de acuerdo", translation: "einverstanden" },
        { term: "la gramática", translation: "die Grammatik" },
        { term: "el vocabulario", translation: "der Wortschatz" },
        { term: "la película", translation: "der Film" },
        { term: "el regalo", translation: "das Geschenk" },
        { term: "la letra (de una canción)", translation: "der (Lied)text" },
        { term: "España", translation: "Spanien" },
        { term: "bailar", translation: "tanzen" },
        { term: "comer algo", translation: "etw. essen" },
        { term: "descansar", translation: "sich entspannen, ausruhen" },
        { term: "comprar algo", translation: "etw. kaufen" },
        { term: "tomar algo", translation: "etw. nehmen, hier: etw. trinken" },
        { term: "el diálogo", translation: "der Dialog" },
        { term: "el tema", translation: "das Thema" },
        { term: "el ejercicio", translation: "die Übung" },
      ];

      // --- GLOBALER STATUS ---
      let currentCardIndex = 0;
      let isFlipped = false;
      let isGermanFirst = true;
      let shuffledData = [...vocabData];
      let currentMode = "flashcard"; // 'flashcard', 'quiz', 'write'
      let quizTimerInterval;
      let currentQuizAnswer = "";

      // --- DOM-ELEMENTE (Global) ---
      const modeButtons = {
        flashcard: document.getElementById("mode-flashcard"),
        quiz: document.getElementById("mode-quiz"),
        write: document.getElementById("mode-write"),
      };
      const views = {
        flashcard: document.getElementById("flashcard-view"),
        quiz: document.getElementById("quiz-view"),
        write: document.getElementById("write-view"),
      };

      // --- DOM-ELEMENTE (Flashcard) ---
      const cardContainer = document.getElementById("card");
      const cardFrontLabel = document.getElementById("card-front-label");
      const cardFrontText = document.getElementById("card-front-text");
      const cardFrontExpl = document.getElementById("card-front-expl");
      const cardBackLabel = document.getElementById("card-back-label");
      const cardBackTextEn = document.getElementById("card-back-text-en");
      const cardBackTextExpl = document.getElementById("card-back-text-expl");
      const progressText = document.getElementById("progress");
      const prevButton = document.getElementById("prev-btn");
      const flipButton = document.getElementById("flip-btn");
      const nextButton = document.getElementById("next-btn");
      const shuffleButton = document.getElementById("shuffle-btn");
      const toggleDirectionBtn = document.getElementById(
        "toggle-direction-btn"
      );

      // --- DOM-ELEMENTE (Quiz) ---
      const quizProgress = document.getElementById("quiz-progress");
      const quizTimer = document.getElementById("quiz-timer");
      const quizQuestionLabel = document.getElementById("quiz-question-label");
      const quizQuestion = document.getElementById("quiz-question");
      const quizExplanation = document.getElementById("quiz-explanation");
      const quizOptions = [
        document.getElementById("quiz-option-0"),
        document.getElementById("quiz-option-1"),
        document.getElementById("quiz-option-2"),
        document.getElementById("quiz-option-3"),
      ];
      const quizFeedback = document.getElementById("quiz-feedback");
      const quizNextBtn = document.getElementById("quiz-next-btn");

      // --- DOM-ELEMENTE (Write) ---
      const writeProgress = document.getElementById("write-progress");
      const writeQuestionLabel = document.getElementById(
        "write-question-label"
      );
      const writeQuestion = document.getElementById("write-question");
      const writeExplanation = document.getElementById("write-explanation");
      const writeInput = document.getElementById("write-input");
      const writeFeedback = document.getElementById("write-feedback");
      const writeCheckBtn = document.getElementById("write-check-btn");
      const writeShowBtn = document.getElementById("write-show-btn");
      const writeNextBtn = document.getElementById("write-next-btn");

      // --- MODUS-WECHSLER ---
      function showMode(mode) {
        currentMode = mode;
        // Alle Ansichten ausblenden
        Object.values(views).forEach((view) => view.classList.add("hidden"));
        // Aktive Ansicht anzeigen
        views[mode].classList.remove("hidden");

        // Alle Knöpfe deaktivieren
        Object.values(modeButtons).forEach((btn) =>
          btn.classList.remove("active")
        );
        // Aktiven Knopf hervorheben
        modeButtons[mode].classList.add("active");

        // Modus-spezifische Initialisierung
        if (mode === "flashcard") {
          shuffleCards(); // Beim Wechsel zurück neu mischen
        } else if (mode === "quiz") {
          startQuiz();
        } else if (mode === "write") {
          startWrite();
        }
      }

      // --- LERNKARTEN (Flashcard) ---
      function shuffleCards() {
        for (let i = shuffledData.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [shuffledData[i], shuffledData[j]] = [
            shuffledData[j],
            shuffledData[i],
          ];
        }
        currentCardIndex = 0;
        isFlipped = false;
        displayCard();
      }

      function displayCard() {
        const card = shuffledData[currentCardIndex];
        if (isGermanFirst) {
          cardFrontLabel.textContent = "Deutsch";
          cardFrontText.textContent = card.translation;
          cardFrontExpl.textContent = "";
          cardBackLabel.textContent = "Español";
          cardBackTextEn.textContent = card.term;
          cardBackTextExpl.textContent = "";
        } else {
          cardFrontLabel.textContent = "Español";
          cardFrontText.textContent = card.term;
          cardFrontExpl.textContent = "";
          cardBackLabel.textContent = "Deutsch";
          cardBackTextEn.textContent = card.translation;
          cardBackTextExpl.textContent = "";
        }
        progressText.textContent = `Karte ${currentCardIndex + 1} / ${
          shuffledData.length
        }`;
        cardContainer.classList.remove("flipped");
        isFlipped = false;
      }

      function flipCard() {
        cardContainer.classList.toggle("flipped");
        isFlipped = !isFlipped;
      }

      function nextCard() {
        currentCardIndex = (currentCardIndex + 1) % shuffledData.length;
        displayCard();
      }

      function prevCard() {
        currentCardIndex =
          (currentCardIndex - 1 + shuffledData.length) % shuffledData.length;
        displayCard();
      }

      function toggleDirection() {
        isGermanFirst = !isGermanFirst;
        displayCard();
      }

      // --- QUIZ (Multiple Choice) ---
      function startQuiz() {
        shuffleCards(); // Verwendet die global gemischte Liste
        currentCardIndex = 0;
        loadQuizQuestion();
      }

      function loadQuizQuestion() {
        // Timer stoppen, falls er läuft
        clearInterval(quizTimerInterval);

        // UI zurücksetzen
        quizFeedback.textContent = "";
        quizNextBtn.classList.add("hidden");
        quizOptions.forEach((btn) => {
          btn.classList.remove("correct", "incorrect");
          btn.disabled = false;
        });

        // Timer starten
        let timeLeft = 10;
        quizTimer.textContent = timeLeft;
        quizTimerInterval = setInterval(() => {
          timeLeft--;
          quizTimer.textContent = timeLeft;
          if (timeLeft <= 0) {
            clearInterval(quizTimerInterval);
            quizFeedback.textContent = "Zeit abgelaufen!";
            quizFeedback.classList.add("text-red-500");
            showQuizAnswer(null); // Zeit abgelaufen, keine Auswahl
          }
        }, 1000);

        // Nächste Frage laden
        quizProgress.textContent = `Frage ${currentCardIndex + 1} / ${
          shuffledData.length
        }`;
        const card = shuffledData[currentCardIndex];

        // 3 falsche Antworten finden
        let distractors = [];
        while (distractors.length < 3) {
          const randomCard =
            vocabData[Math.floor(Math.random() * vocabData.length)];
          if (
            randomCard.term !== card.term &&
            !distractors.some((d) => d.term === randomCard.term)
          ) {
            distractors.push(randomCard);
          }
        }

        // Optionen-Array (mit korrekter Antwort)
        let options = [card, ...distractors];

        // Optionen mischen
        for (let i = options.length - 1; i > 0; i--) {
          const j = Math.floor(Math.random() * (i + 1));
          [options[i], options[j]] = [options[j], options[i]];
        }

        // UI füllen
        if (isGermanFirst) {
          quizQuestionLabel.textContent = "Was heißt...";
          quizQuestion.textContent = card.translation;
          quizExplanation.textContent = "";
          options.forEach((opt, i) => {
            quizOptions[i].textContent = opt.term;
          });
          currentQuizAnswer = card.term;
        } else {
          quizQuestionLabel.textContent = "Was heißt...";
          quizQuestion.textContent = card.term;
          quizExplanation.textContent = "";
          options.forEach((opt, i) => {
            quizOptions[i].textContent = opt.translation;
          });
          currentQuizAnswer = card.translation;
        }
      }

      function checkQuizAnswer(e) {
        clearInterval(quizTimerInterval); // Timer anhalten
        const selectedBtn = e.target;
        showQuizAnswer(selectedBtn);
      }

      function showQuizAnswer(selectedBtn) {
        // Alle Knöpfe deaktivieren
        quizOptions.forEach((btn) => (btn.disabled = true));

        quizOptions.forEach((btn) => {
          if (btn.textContent === currentQuizAnswer) {
            btn.classList.add("correct");
          } else if (btn === selectedBtn) {
            btn.classList.add("incorrect");
          }
        });

        if (selectedBtn && selectedBtn.textContent === currentQuizAnswer) {
          quizFeedback.textContent = "Richtig!";
          quizFeedback.className =
            "text-center font-medium mt-4 h-6 text-green-600";
        } else if (selectedBtn) {
          quizFeedback.textContent = "Leider falsch.";
          quizFeedback.className =
            "text-center font-medium mt-4 h-6 text-red-600";
        } else {
          quizFeedback.textContent = "Zeit abgelaufen!";
          quizFeedback.className =
            "text-center font-medium mt-4 h-6 text-red-600";
        }

        quizNextBtn.classList.remove("hidden");
      }

      function nextQuizQuestion() {
        currentCardIndex = (currentCardIndex + 1) % shuffledData.length;
        loadQuizQuestion();
      }

      // --- SCHREIBEN (Write) ---
      function startWrite() {
        shuffleCards();
        currentCardIndex = 0;
        loadWriteQuestion();
      }

      function loadWriteQuestion() {
        writeProgress.textContent = `Frage ${currentCardIndex + 1} / ${
          shuffledData.length
        }`;
        const card = shuffledData[currentCardIndex];

        if (isGermanFirst) {
          writeQuestionLabel.textContent = "Übersetze:";
          writeQuestion.textContent = card.translation;
          writeExplanation.textContent = "";
          currentQuizAnswer = card.term; // Wiederverwenden der Variable
        } else {
          writeQuestionLabel.textContent = "Übersetze:";
          writeQuestion.textContent = card.term;
          writeExplanation.textContent = "";
          currentQuizAnswer = card.translation;
        }

        // UI zurücksetzen
        writeInput.value = "";
        writeInput.disabled = false;
        writeInput.className =
          "w-full text-xl p-4 border-2 rounded-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-gray-800";
        writeFeedback.innerHTML = "";
        writeCheckBtn.classList.remove("hidden");
        writeShowBtn.classList.remove("hidden");
        writeNextBtn.classList.add("hidden");
      }

      function checkWriteAnswer() {
        const userAnswer = writeInput.value.trim();
        if (userAnswer === "") return;

        // Einfache Prüfung (für "to ..." Vokabeln)
        const isCorrect =
          userAnswer.toLowerCase() === currentQuizAnswer.toLowerCase();

        if (isCorrect) {
          writeInput.classList.add("correct");
          writeFeedback.innerHTML = `<span class="text-green-600 font-semibold">Richtig!</span>`;
          writeInput.disabled = true;
          writeCheckBtn.classList.add("hidden");
          writeShowBtn.classList.add("hidden");
          writeNextBtn.classList.remove("hidden");
        } else {
          writeInput.classList.add("incorrect");
          writeFeedback.innerHTML = `<span class="text-red-600 font-semibold">Fast... Versuche es nochmal!</span>`;
          // Klasse nach 1s entfernen, um erneute Eingabe zu signalisieren
          setTimeout(() => {
            writeInput.classList.remove("incorrect");
          }, 1000);
        }
      }

      function showWriteAnswer() {
        writeFeedback.innerHTML = `Die richtige Antwort ist: <strong class="text-gray-900">${currentQuizAnswer}</strong>`;
        writeInput.disabled = true;
        writeCheckBtn.classList.add("hidden");
        writeShowBtn.classList.add("hidden");
        writeNextBtn.classList.remove("hidden");
      }

      function nextWriteQuestion() {
        currentCardIndex = (currentCardIndex + 1) % shuffledData.length;
        loadWriteQuestion();
      }

      // --- GLOBALE EVENT HANDLER ---
      function handleKey(e) {
        // Verhindern, wenn in Textfeld getippt wird (außer Enter im Schreib-Modus)
        if (e.target.tagName === "INPUT" && e.key !== "Enter") return;

        if (currentMode === "flashcard") {
          switch (e.key) {
            case "ArrowLeft":
              prevCard();
              break;
            case "ArrowRight":
              nextCard();
              break;
            case " ":
              e.preventDefault();
              flipCard();
              break;
            case "r":
            case "R":
              toggleDirection();
              break;
            case "s":
            case "S":
              shuffleCards();
              break;
          }
        } else if (currentMode === "quiz") {
          if (
            e.key === "ArrowRight" &&
            !quizNextBtn.classList.contains("hidden")
          ) {
            nextQuizQuestion();
          }
        } else if (currentMode === "write") {
          if (e.key === "Enter") {
            if (!writeNextBtn.classList.contains("hidden")) {
              nextWriteQuestion();
            } else {
              checkWriteAnswer();
            }
          }
          if (
            e.key === "ArrowRight" &&
            !writeNextBtn.classList.contains("hidden")
          ) {
            nextWriteQuestion();
          }
        }
      }

      // --- INITIALISIERUNG ---
      document.addEventListener("DOMContentLoaded", () => {
        // Modus-Wechsler
        modeButtons.flashcard.addEventListener("click", () =>
          showMode("flashcard")
        );
        modeButtons.quiz.addEventListener("click", () => showMode("quiz"));
        modeButtons.write.addEventListener("click", () => showMode("write"));

        // Flashcard Listeners
        flipButton.addEventListener("click", flipCard);
        cardContainer.addEventListener("click", flipCard);
        nextButton.addEventListener("click", nextCard);
        prevButton.addEventListener("click", prevCard);
        shuffleButton.addEventListener("click", shuffleCards);
        toggleDirectionBtn.addEventListener("click", toggleDirection);

        // Quiz Listeners
        quizOptions.forEach((btn) =>
          btn.addEventListener("click", checkQuizAnswer)
        );
        quizNextBtn.addEventListener("click", nextQuizQuestion);

        // Write Listeners
        writeCheckBtn.addEventListener("click", checkWriteAnswer);
        writeShowBtn.addEventListener("click", showWriteAnswer);
        writeNextBtn.addEventListener("click", nextWriteQuestion);
        writeInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") checkWriteAnswer();
        });

        // Global Key Listener
        document.addEventListener("keydown", handleKey);

        // Standard-Modus starten
        showMode("flashcard");
      });
    </script>
  </body>
</html>
